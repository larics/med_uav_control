<launch>

    <arg name="rc_joy" default="false"/>
    <arg name="logitech_joy" default="false"/>
    <arg name="run_experiment" default="true"/>
    <arg name="record_experiment" default="true"/>
    <arg name="joy_rate" default="10"/>

	<!-- Launch UAV -->
    <include file="$(find med_uav_description)/launch/gazebo_bebop.launch">
        <arg name="wind_force" value="0.0"/>
        <arg name="wind_start" default="5.0"/>
        <arg name="wind_duration" default="10.0"/>
        <arg name="wind_direction_x" default="0.0"/>
        <arg name="wind_direction_y" default="0.0"/>
        <arg name="wind_direction_z" default="1.0"/>
    </include>

    <group ns="bebop">
        <node pkg="med_uav_control" type="height_ctl.py" name="height_ctl" output="screen"/>
        <node pkg="med_uav_control" type="attitude_ctl.py" name="attitude_ctl" output="screen"/>
        
        <!-- if joystick active, there's no need for position control -->
        <!--node pkg="med_uav_control" type="horizontal_ctl.py" name="horizontal_ctl" output="screen"/-->

        <node pkg="med_uav_control" type="trajectory_to_position_reference.py" name="trajectory_to_position_reference" output="screen" />
    </group>

    <!-- Run rosserial_arduino for rc joystick -->
    <group if="$(arg rc_joy)">
        
        <include file="$(find med_uav_control)/launch/rc_joystick.launch">
            <arg name="port" default="/dev/ttyUSB0" />
            <arg name="baud" default="115200" />    
        </include>

        <node pkg="med_uav_control" type="futaba_to_joy.py" name="futaba_to_ros" output="screen"/>

    </group>
    
    <!-- Run normal joy node for normal joystick -->
    <group if="$(arg logitech_joy)">

        <node name="joy" pkg="joy" type="joy_node" output="screen">
            <param name="autorepeat_rate" value="$(arg joy_rate)"/>
        </node>

    </group>

    <!-- Record bag for experiment -->
    <!--group if="$(arg run_experiment)">
        <node name="observer" pkg="med_uav_control" type="observer.py" output="screen"></node>

    </group-->

    <!-- RUN FPV -->
    <!--node name="fpv_node" pkg="rqt_image_view" type="rqt_image_view" output="screen"/-->
        
    <include file="$(find med_uav_control)/launch/bebop_joy_override.launch"/>

    <node pkg="rosbag" type="record" name="record_experiment"
       args="record -o /home/developer/catkin_ws/src/med_uav_control/experiments/exp /bebop/odometry /joy /duration" if="$(arg record_experiment)" />

    
</launch>